!DOCTYPE html
html lang=en
head
    meta charset=UTF-8
    meta name=viewport content=width=device-width, initial-scale=1.0
    titleTIME REPORT - Advanced Searchtitle
    link href=httpsfonts.googleapis.comcss2family=Robotowght@400;700&display=swap rel=stylesheet
    link rel=stylesheet href=httpscdnjs.cloudflare.comajaxlibsfont-awesome6.4.0cssall.min.css
    script src=httpshtml2canvas.hertzen.comdisthtml2canvas.min.jsscript
    script src=httpscdnjs.cloudflare.comajaxlibsjspdf2.5.1jspdf.umd.min.jsscript
    style
        body {
            font-family 'Roboto', sans-serif;
            margin 0;
            padding 20px;
            background linear-gradient(135deg, #e9eff4 0%, #d1dbe6 100%);
            display flex;
            justify-content center;
            align-items flex-start;
            min-height 100vh;
        }

        .container {
            width 100%;
            max-width 1000px;
            background #ffffff;
            padding 20px;
            border-radius 8px;
            box-shadow 0 6px 15px rgba(0, 0, 0, 0.1);
            box-sizing border-box;
        }

        .header {
            display flex;
            justify-content space-between;
            align-items center;
            border-bottom 2px solid #e0e0e2;
            padding-bottom 15px;
            margin-bottom 20px;
        }

        .header h1 {
            margin 0;
            font-size 24px;
            color #333;
        }

        .header .subtitle {
            color #666;
            font-size 14px;
        }

        .back-link {
            text-decoration none;
            color #1f81eb;
            font-weight bold;
            display flex;
            align-items center;
            gap 5px;
        }
        .back-linkhover {
            color #1a6dc7;
        }

        .search-controls {
            display flex;
            gap 10px;
            margin-bottom 20px;
        }

        .search-input {
            flex-grow 1;
            padding 10px;
            border 1px solid #ced4da;
            border-radius 6px;
            font-size 16px;
        }

        .toggle-filters-btn {
            padding 10px 15px;
            background #6c757d;
            color white;
            border none;
            border-radius 6px;
            cursor pointer;
            font-weight bold;
            transition background 0.3s;
        }
        .toggle-filters-btnhover {
            background #5a6268;
        }

        .filters-section {
            background-color #f8f9fa;
            padding 20px;
            border-radius 8px;
            margin-bottom 20px;
            border 1px solid #dee2e6;
        }

        .filters-grid {
            display grid;
            grid-template-columns repeat(auto-fit, minmax(200px, 1fr));
            gap 15px;
        }

        .filter-group label {
            display block;
            margin-bottom 5px;
            font-weight bold;
            color #495057;
        }

        .filter-group input,
        .filter-group select {
            width 100%;
            padding 8px;
            border 1px solid #ced4da;
            border-radius 4px;
            box-sizing border-box;
        }

        .results-table {
            width 100%;
            border-collapse collapse;
            margin-top 20px;
        }

        .results-table th,
        .results-table td {
            padding 12px;
            text-align left;
            border-bottom 1px solid #dee2e6;
        }

        .results-table th {
            background-color #f4b400;
            color #333;
            font-weight 700;
        }

        .results-table tbody trhover {
            background-color #f1f3f5;
        }

        .actions-cell {
            display flex;
            gap 10px;
            flex-wrap wrap;
        }

        .action-btn {
            padding 6px 12px;
            border none;
            border-radius 4px;
            cursor pointer;
            text-decoration none;
            color white;
            font-size 14px;
            transition background-color 0.2s;
        }

        .view-btn {
            background-color #17a2b8;
        }
        .view-btnhover {
            background-color #138496;
        }

        .edit-btn {
            background-color #ffc107;
            color #212529;
        }
        .edit-btnhover {
            background-color #e0a800;
        }

        .delete-btn {
            background-color #dc3545;
        }
        .delete-btnhover {
            background-color #c82333;
        }
        
        .download-pdf-btn {
            background-color #6f42c1;
        }
        .download-pdf-btnhover {
            background-color #5a32a3;
        }
        
         Modal Styles 
        .modal {
            display none; 
            position fixed; 
            z-index 1000; 
            left 0;
            top 0;
            width 100%; 
            height 100%; 
            overflow auto; 
            background-color rgba(0,0,0,0.5); 
        }
        .modal-content {
            background-color #fefefe;
            margin 10% auto; 
            padding 20px;
            border 1px solid #888;
            width 80%;
            max-width 500px;
            border-radius 8px;
        }
        .close {
            color #aaa;
            float right;
            font-size 28px;
            font-weight bold;
        }
        .closehover,
        .closefocus {
            color black;
            text-decoration none;
            cursor pointer;
        }

         Loading indicator 
        .loading-indicator {
            position fixed;
            top 50%;
            left 50%;
            transform translate(-50%, -50%);
            background-color rgba(0, 0, 0, 0.8);
            color white;
            padding 20px 30px;
            border-radius 8px;
            font-size 18px;
            z-index 2000;
            display none;
        }
    style
head
body

    div class=container
        div class=header
            div
                h1Advanced Searchh1
                p class=subtitleFind specific time reports with detailed filtersp
            div
            a href=index.html class=back-link
                i class=fas fa-arrow-lefti
                Back to Home
            a
        div

        div class=search-controls
            input type=text id=mainSearchInput class=search-input placeholder=Search by Vessel, Voyage, etc.
            button class=toggle-filters-btn onclick=toggleFilters()
                i class=fas fa-filteri Hide Filters
            button
        div

        div id=filtersSection class=filters-section
            div class=filters-grid
                div class=filter-group
                    label for=startDateStart Datelabel
                    input type=date id=startDate name=startDate
                div
                div class=filter-group
                    label for=endDateEnd Datelabel
                    input type=date id=endDate name=endDate
                div
                div class=filter-group
                    label for=yardFilterYardlabel
                    select id=yardFilter name=yardFilter
                        option value=All Yardsoption
                        option value=Admin GateAdmin Gateoption
                        option value=Gate INGate INoption
                        option value=Yard-DBYard-DBoption
                        option value=Yard-ROROYard-ROROoption
                    select
                div
                div class=filter-group
                    label for=berthFilterBerthlabel
                    select id=berthFilter name=berthFilter
                        option value=All Berthsoption
                        option value=110110option
                        option value=120120option
                        option value=130130option
                        option value=FB-200FB-200option
                    select
                div
            div
        div

        table class=results-table
            thead
                tr
                    thDateth
                    thVesselth
                    thVoyageth
                    thShiftth
                    thBerthth
                    thYardth
                    thActionsth
                tr
            thead
            tbody id=reportsTableBody
                !-- Reports will be dynamically inserted here --
            tbody
        table
    div

    !-- The Modal --
    div id=viewModal class=modal
        div class=modal-content
            span class=close&times;span
            h2Report Detailsh2
            div id=modalBodyContent
                !-- Content will be dynamically inserted here --
            div
        div
    div

    !-- Loading Indicator --
    div id=loadingIndicator class=loading-indicator
        Generating PDF, please wait...
    div

    script
         Load reports when page is ready
        document.addEventListener('DOMContentLoaded', loadReportsFromStorage);

        function loadReportsFromStorage() {
            const reports = JSON.parse(localStorage.getItem('timeReports'))  [];
            const tableBody = document.getElementById('reportsTableBody');
            tableBody.innerHTML = '';  Clear existing rows

            if (reports.length === 0) {
                tableBody.innerHTML = 'trtd colspan=7 style=text-aligncenter;No reports found.tdtr';
                return;
            }

            reports.forEach(report = {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    td${report.date}td
                    td${report.mv}td
                    td${report.voy}td
                    td${report.shift}td
                    td${report.berth}td
                    td${report.yardno}td
                    td class=actions-cell
                        button class=action-btn view-btn onclick=viewReport('${report.id}')Viewbutton
                        a href=create_report.htmleditId=${report.id} class=action-btn edit-btnEdita
                        button class=action-btn delete-btn onclick=deleteReport('${report.id}')Deletebutton
                        button class=action-btn download-pdf-btn onclick=downloadReportAsPdf('${report.id}')i class=fas fa-file-pdfi PDFbutton
                    td
                `;
            });
        }

        function viewReport(reportId) {
            const reports = JSON.parse(localStorage.getItem('timeReports'))  [];
            const report = reports.find(r = r.id === reportId);
            
            if (report) {
                const modal = document.getElementById('viewModal');
                const modalBody = document.getElementById('modalBodyContent');
                
                modalBody.innerHTML = `
                    pstrongVesselstrong ${report.mv}p
                    pstrongVoyagestrong ${report.voy}p
                    pstrongDatestrong ${report.date}p
                    pstrongShiftstrong ${report.shift}p
                    pstrongWhat We Dostrong ${report.what_we_do  'NA'}p
                    hr
                    h4Teamh4
                    pstrongForemanstrong ${report.team  report.team.foreman.join(', ')  'NA'}p
                    pstrongTallymanstrong ${report.team  report.team.tallyman.join(', ')  'NA'}p
                    pstrongDockerstrong ${report.team  report.team.docker.join(', ')  'NA'}p
                `;
                modal.style.display = block;
            }
        }

        function deleteReport(reportId) {
            if (confirm('Are you sure you want to delete this report This action cannot be undone.')) {
                let reports = JSON.parse(localStorage.getItem('timeReports'))  [];
                reports = reports.filter(r = r.id !== reportId);
                localStorage.setItem('timeReports', JSON.stringify(reports));
                loadReportsFromStorage();  Refresh the table
            }
        }

        function toggleFilters() {
            const filtersSection = document.getElementById('filtersSection');
            const button = document.querySelector('.toggle-filters-btn');
            
            if (filtersSection.style.display === 'none') {
                filtersSection.style.display = 'block';
                button.innerHTML = 'i class=fas fa-filteri Hide Filters';
            } else {
                filtersSection.style.display = 'none';
                button.innerHTML = 'i class=fas fa-filteri Show Filters';
            }
        }
        
         Modal Close Logic
        const modal = document.getElementById('viewModal');
        const span = document.getElementsByClassName(close)[0];
        span.onclick = function() {
            modal.style.display = none;
        }
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = none;
            }
        }

         Search functionality
        document.getElementById('mainSearchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#reportsTableBody tr');
            
            rows.forEach(row = {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm)  ''  'none';
            });
        });

         --- NEW PDF DOWNLOAD FUNCTION ---
        function downloadReportAsPdf(reportId) {
            const reports = JSON.parse(localStorage.getItem('timeReports'))  [];
            const report = reports.find(r = r.id === reportId);

            if (!report) {
                alert(Report not found!);
                return;
            }

            const loadingIndicator = document.getElementById('loadingIndicator');
            loadingIndicator.style.display = 'block';

             Create a hidden container to render the report
            const pdfContainer = document.createElement('div');
            pdfContainer.id = 'pdfContainer';
            pdfContainer.style.position = 'absolute';
            pdfContainer.style.left = '-9999px';
            pdfContainer.style.top = '0';
            pdfContainer.style.width = '800px';
            pdfContainer.style.padding = '10px';
            pdfContainer.style.backgroundColor = '#fff';
            pdfContainer.style.fontFamily = 'Roboto, sans-serif';
            
            document.body.appendChild(pdfContainer);

             Build the report HTML inside the container
            pdfContainer.innerHTML = buildReportHtml(report);

             Use a timeout to ensure the content is rendered before capturing
            setTimeout(() = {
                html2canvas(pdfContainer, {
                    scale 2,
                    useCORS true,
                    logging false
                }).then(canvas = {
                    const imgData = canvas.toDataURL('imagepng');
                    const pdf = new jspdf.jsPDF('p', 'pt', 'a4');
                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const pageHeight = pdf.internal.pageSize.getHeight();

                    const imgProps = pdf.getImageProperties(imgData);
                    const imgWidth = imgProps.width;
                    const imgHeight = imgProps.height;

                    const ratio = pageWidth  imgWidth;
                    const scaledHeight = imgHeight  ratio;

                    let position = 0;
                    pdf.addImage(imgData, 'PNG', 0, position, pageWidth, scaledHeight);
                    position -= pageHeight;

                    while (position  -scaledHeight) {
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, pageWidth, scaledHeight);
                        position -= pageHeight;
                    }

                    pdf.save(`time_report_${report.date}_${report.mv}.pdf`);
                    
                     Clean up
                    document.body.removeChild(pdfContainer);
                    loadingIndicator.style.display = 'none';
                });
            }, 500);  500ms delay for rendering
        }

        function buildReportHtml(report) {
            const team = report.team  { foreman [], tallyman [], docker [] };
            const timeRecords = report.timeRecords  [];
            const equipment = report.equipment  [];  Assuming equipment data is stored

            let timeRowsHtml = '';
            timeRecords.forEach(rec = {
                timeRowsHtml += `
                    tr
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${rec.start  ''}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${rec.end  ''}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${rec.quantity  ''}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${rec.what_we_use  ''}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;td
                    tr
                `;
            });
            
            let equipmentRowsHtml = '';
            equipment.forEach(eq = {
                equipmentRowsHtml += `
                    tr
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${eq.Equipment  ''}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${eq.operator1  ''}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${eq.start1  ''}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${eq.end1  ''}td
                    tr
                `;
            });

            return `
                table style=border-collapse collapse; width 100%; margin-bottom 10px; border 1px solid #c0c0c0;
                    trtd colspan=7 style=text-align center; font-size 24px; font-weight 700; padding 10px 0; background linear-gradient(to right, #e0e0e2, #f8fafa); color #333;TIME REPORTtdtr
                table
                table style=border-collapse collapse; width 100%; margin-bottom 10px; border 1px solid #c0c0c0;
                    tr style=background linear-gradient(to bottom, #f4b400); color #333; font-weight 700;
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;MVth
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;VOYth
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Dateth
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Shiftth
                    tr
                    tr
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${report.mv}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${report.voy}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${report.date}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${report.shift}td
                    tr
                table
                table style=border-collapse collapse; width 100%; margin-bottom 10px; border 1px solid #c0c0c0;
                    tr style=background linear-gradient(to bottom, #f4b400); color #333; font-weight 700;
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Berthth
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Bollardth
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Yard Noth
                    tr
                    tr
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${report.berth}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${report.bollard}td
                        td style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;${report.yardno}td
                    tr
                table
                table style=border-collapse collapse; width 100%; margin-bottom 10px; border 1px solid #c0c0c0;
                    tr style=background linear-gradient(to bottom, #f4b400); color #333; font-weight 700;
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Start Timeth
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;End Timeth
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Noth
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;What We Useth
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;th
                    tr
                    tbody${timeRowsHtml}tbody
                table
                table style=border-collapse collapse; width 100%; margin-bottom 10px; border 1px solid #c0c0c0;
                    tr style=background linear-gradient(to bottom, #f4b400); color #333; font-weight 700;
                        th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px; What We Doth
                    tr
                    tr
                        td style=border 1px solid #c0c0c0; padding 10px; text-align left; font-size 14px; white-space pre-wrap; word-wrap break-word;${report.what_we_do  ''}td
                    tr
                table
                table style=border-collapse collapse; width 100%; margin-bottom 20px; border 1px solid #c0c0c0;
                    thead
                        tr style=background linear-gradient(to bottom, #f4b400); color #333; font-weight 700;
                            th style=border 1px solid #c0c0c0; padding 8px; text-align center; font-size 14px;FOREMANth
                            th style=border 1px solid #c0c0c0; padding 8px; text-align center; font-size 14px;TALLYMANth
                            th style=border 1px solid #c0c0c0; padding 8px; text-align center; font-size 14px;DOCKERth
                        tr
                    thead
                    tbody
                        tr
                            td style=border 1px solid #c0c0c0; padding 8px; text-align left; font-size 14px;${team.foreman.join(', ')}td
                            td style=border 1px solid #c0c0c0; padding 8px; text-align left; font-size 14px;${team.tallyman.join(', ')}td
                            td style=border 1px solid #c0c0c0; padding 8px; text-align left; font-size 14px;${team.docker.join(', ')}td
                        tr
                    tbody
                table
                ${equipment.length  0  `
                table style=border-collapse collapse; width 100%; border 1px solid #c0c0c0;
                    thead
                        tr style=background linear-gradient(to bottom, #f4b400); color #333; font-weight 700;
                            th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Equipmentth
                            th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Operator 1th
                            th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Startth
                            th style=border 1px solid #c0c0c0; padding 3px; text-align center; font-size 14px;Endth
                        tr
                    thead
                    tbody${equipmentRowsHtml}tbody
                table
                `  ''}
            `;
        }
    script

body
html